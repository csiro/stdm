<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self Thinking Data Manifest Specification v0.1</title>
    <style>
/* Basic Reset */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; line-height: 1.6; color: #333; background-color: #f8f9fa; padding: 20px; }
.container { max-width: 900px; margin: 20px auto; background-color: #ffffff; padding: 30px 40px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
h1 { font-size: 2.2em; color: #0056b3; margin-bottom: 25px; border-bottom: 2px solid #dee2e6; padding-bottom: 10px; text-align: center; }
h2 { font-size: 1.8em; color: #17a2b8; margin-top: 40px; margin-bottom: 20px; border-bottom: 1px solid #e9ecef; padding-bottom: 8px; }
h3 { font-size: 1.4em; color: #6c757d; margin-top: 25px; margin-bottom: 15px; }
p { margin-bottom: 15px; text-align: justify; }
ul, ol { margin-left: 25px; margin-bottom: 15px; }
li { margin-bottom: 8px; }
ul ul, ol ol, ul ol, ol ul { margin-left: 20px; margin-top: 8px; }
b, strong { font-weight: bold; color: #333; }
code { font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; background-color: #e9ecef; padding: 0.2em 0.4em; border-radius: 3px; font-size: 0.9em; color: #c7254e; }
pre { background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 1em; overflow-x: auto; margin-bottom: 15px; white-space: pre-wrap; word-wrap: break-word; }
pre code { background-color: transparent; padding: 0; border-radius: 0; color: inherit; font-size: 0.9em; white-space: pre-wrap; word-wrap: break-word; border: none; }
hr { border: 0; height: 1px; background: #dee2e6; margin: 40px 0; }
.footer-note { text-align: center; font-style: italic; color: #6c757d; margin-top: 20px; font-size: 0.9em; }
/* Pygments CSS for Syntax Highlighting (Optional but recommended) */
.codehilite pre { background-color: #f8f9fa !important; padding: 1em !important; border: 1px solid #dee2e6 !important; }
.codehilite .hll { background-color: #ffc; } /* Highlighted line */
.codehilite .c { color: #999; } /* Comment */
.codehilite .k { color: #069; } /* Keyword */
.codehilite .o { color: #555; } /* Operator */
.codehilite .cm { color: #999; } /* Comment.Multiline */
.codehilite .cp { color: #099; } /* Comment.Preproc */
.codehilite .c1 { color: #999; } /* Comment.Single */
.codehilite .cs { color: #999; } /* Comment.Special */
.codehilite .gd { background-color: #fcc; border: 1px solid #c00 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #f00 } /* Generic.Error */
.codehilite .gh { color: #030 } /* Generic.Heading */
.codehilite .gi { background-color: #cfc; border: 1px solid #0c0 } /* Generic.Inserted */
.codehilite .go { color: #aaa } /* Generic.Output */
.codehilite .gp { color: #009 } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #030 } /* Generic.Subheading */
.codehilite .gt { color: #9c6 } /* Generic.Traceback */
.codehilite .kc { color: #069 } /* Keyword.Constant */
.codehilite .kd { color: #069 } /* Keyword.Declaration */
.codehilite .kn { color: #069 } /* Keyword.Namespace */
.codehilite .kp { color: #069 } /* Keyword.Pseudo */
.codehilite .kr { color: #069 } /* Keyword.Reserved */
.codehilite .kt { color: #078 } /* Keyword.Type */
.codehilite .m { color: #f60 } /* Literal.Number */
.codehilite .s { color: #d44950 } /* Literal.String */
.codehilite .na { color: #4f9fcf } /* Name.Attribute */
.codehilite .nb { color: #366 } /* Name.Builtin */
.codehilite .nc { color: #0a8 } /* Name.Class */
.codehilite .no { color: #360 } /* Name.Constant */
.codehilite .nd { color: #99f } /* Name.Decorator */
.codehilite .ni { color: #999 } /* Name.Entity */
.codehilite .ne { color: #c00 } /* Name.Exception */
.codehilite .nf { color: #06c } /* Name.Function */
.codehilite .nl { color: #99f } /* Name.Label */
.codehilite .nn { color: #0a8 } /* Name.Namespace */
.codehilite .nt { color: #2f6f9f; } /* Name.Tag */
.codehilite .nv { color: #033 } /* Name.Variable */
.codehilite .ow { color: #000 } /* Operator.Word */
.codehilite .w { color: #bbb } /* Text.Whitespace */
.codehilite .mf { color: #f60 } /* Literal.Number.Float */
.codehilite .mh { color: #f60 } /* Literal.Number.Hex */
.codehilite .mi { color: #f60 } /* Literal.Number.Integer */
.codehilite .mo { color: #f60 } /* Literal.Number.Oct */
.codehilite .sb { color: #d44950 } /* Literal.String.Backtick */
.codehilite .sc { color: #d44950 } /* Literal.String.Char */
.codehilite .sd { color: #d44950; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #d44950 } /* Literal.String.Double */
.codehilite .se { color: #c678dd } /* Literal.String.Escape */
.codehilite .sh { color: #d44950 } /* Literal.String.Heredoc */
.codehilite .si { color: #f60 } /* Literal.String.Interpol */
.codehilite .sx { color: #d44950 } /* Literal.String.Other */
.codehilite .sr { color: #099 } /* Literal.String.Regex */
.codehilite .s1 { color: #d44950 } /* Literal.String.Single */
.codehilite .ss { color: #f60 } /* Literal.String.Symbol */
.codehilite .bp { color: #366 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #033 } /* Name.Variable.Class */
.codehilite .vg { color: #033 } /* Name.Variable.Global */
.codehilite .vi { color: #033 } /* Name.Variable.Instance */
.codehilite .il { color: #f60 } /* Literal.Number.Integer.Long */

@media (max-width: 768px) {
    .container { padding: 20px; }
    h1 { font-size: 1.8em; }
    h2 { font-size: 1.5em; }
    h3 { font-size: 1.2em; }
    p { text-align: left; }
}
    </style>
    <script>
// Basic script to confirm JS is running.
document.addEventListener('DOMContentLoaded', () => {
    console.log("STDM v1.6 Specification page loaded successfully.");
});
    </script>
    <!-- STDM START: This block contains the STDM instructions and metadata -->
    <!--
{{stdm_instructions_block_content}}
    -->
    <!-- STDM END -->

</head>
<body>

    <div class="container">
        <h1>Self Thinking Data Manifest Specification v0.1</h1>
        <div style="background: #f8f9fa; border-bottom: 1px solid #ccc; padding: 1em; text-align: center; font-family: sans-serif;">
            <strong>This document is an STDM (Self-Thinking Data Manifest).</strong>
            <div style="margin: 0.5em 0;">
                <button onclick="downloadPage()" style="padding: 0.5em 1em; font-size: 1em; cursor: pointer;">⬇️ Download Full Spec</button>
                <button onclick="downloadExample()" style="padding: 0.5em 1em; font-size: 1em; cursor: pointer; margin-left: 0.5em;">⬇️ Download Example</button>
            </div>
            <div style="margin: 0.5em 0;">
                <span>To use: <em>Download</em> this file and drag it into an LLM with the prompt: <code>Follow the instructions in the document</code>.</span>
            </div>
            <div style="color: #b94a48; background: #fff3cd; border: 1px solid #f5c6cb; border-radius: 4px; padding: 0.5em; margin-top: 0.7em; font-size: 0.97em;">
                <strong>Warning:</strong> This specification is in development. By design, the "Follow the instructions" prompt may ask an LLM to perform web searches, execute code, or access external information.
            </div>
        </div>
    <!-- DATA START: Contains the primary data (the spec itself) in MARKDOWN format -->
        {{rendered_specification_html_content}}
    <!-- DATA END: Contains the primary data (the spec itself) in MARKDOWN format -->
        <hr>
        <p class="footer-note">End of STDM v1.6 Specification Display</p>

    </div><!-- /container -->

    <script>
    function downloadPage() {
        try {
            const blob = new Blob([document.documentElement.outerHTML], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            let pageTitle = document.title || 'Generated_STDM_Spec';
            const a = document.createElement('a');
            a.href = url;
            a.download = pageTitle.replace(/[^a-z0-9]/gi, '_').toLowerCase() + '.html'; // Sanitize filename
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        } catch (e) {
            console.error("Error downloading page:", e);
            alert("Could not generate download.");
        }
    }

    function downloadExample() {
        try {
            // Find the H2/H3 for Section 8, then find the next pre > code element containing <!DOCTYPE html>
            const sectionHeadings = Array.from(document.querySelectorAll('h2, h3'));
            const section8Heading = sectionHeadings.find(h => /^\s*8\.\s*Example Implementation/.test(h.textContent));

            if (!section8Heading) throw new Error("Section 8 heading not found");

            let sibling = section8Heading.nextElementSibling;
            let exampleCodeElement = null;

            while(sibling) {
                 // Find the code block with the 'language-html' class added by markdown's codehilite
                if (sibling.tagName === 'DIV' && sibling.classList.contains('codehilite')) {
                     const codeEl = sibling.querySelector('pre code');
                     // Check if it looks like the start of the HTML example
                     if (codeEl && /^\s*<!DOCTYPE html>/.test(codeEl.innerHTML.trim())) {
                          exampleCodeElement = codeEl;
                          break;
                     }
                } else if (sibling.tagName === 'PRE') { // Fallback for non-highlighted code
                    const codeEl = sibling.querySelector('code');
                    if (codeEl && /^\s*<!DOCTYPE html>/.test(codeEl.innerHTML.trim())) {
                          exampleCodeElement = codeEl;
                          break;
                     }
                }
                // Stop searching if we hit the next major section heading
                if (sibling.tagName === 'H2' && !/^\s*8\.\s*/.test(sibling.textContent)) {
                    break;
                }
                sibling = sibling.nextElementSibling;
            }

            if (!exampleCodeElement) {
                 throw new Error("Example HTML code block not found after Section 8 heading. Searched for <div class='codehilite'> or <pre> containing <!DOCTYPE html>.");
            }

            // Unescape HTML entities to get the original source code
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = exampleCodeElement.innerHTML; // Use innerHTML which contains the escaped entities
            const originalHtmlCode = tempDiv.textContent || tempDiv.innerText || ""; // Browser decodes entities here

            if (!originalHtmlCode) {
                 throw new Error("Could not extract original HTML from code block.");
            }

            const blob = new Blob([originalHtmlCode], {type: 'text/html'});
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'STDM_Example_Implementation.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        } catch(e) {
            console.error("Error finding or downloading example:", e);
            alert(`Could not find or generate example download. Error: ${e.message}`);
        }
    }
    </script>

</body>
</html>